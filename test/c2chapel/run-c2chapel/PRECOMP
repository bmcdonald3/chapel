#!/usr/bin/env python3

import sys
import os
import subprocess

cfile = sys.argv[1] + '.h'
filename = sys.argv[1] + '.chpl' # this is the file name with no suffix

c2chapelbin = os.path.dirname(sys.argv[3]) + '/c2chapel'

# remove file to ensure that it is the output from c2chapel
os.remove(filename)

regular_output = subprocess.check_output([c2chapelbin, cfile])
gnu_output = subprocess.check_output([c2chapelbin, '--gnu-extensions', cfile])

if regular_output == gnu_output:
    print("REGULAR OUTPUT: ", regular_output)
    f = open(filename, "w")
    # save output to file to ensure that it compiles
    subprocess.Popen([c2chapelbin, "--gnu-extensions", cfile], stdout=f)

